<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simulador de Entrevista â€“ TechNova Solutions</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --brand-blue:#0b5394;--brand-green:#22b14c;
  --bg-light:#f0f4f8;--bg-dark:#111827;
  --card-light:#fff;--card-dark:#1f2937;
  --ink-light:#111827;--ink-dark:#f9fafb;
  --shadow:0 8px 24px rgba(0,0,0,.15);
  --radius:16px;--transition:.3s ease;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Inter,sans-serif;background:var(--bg-light);color:var(--ink-light);transition:background var(--transition),color var(--transition)}
body.dark{background:var(--bg-dark);color:var(--ink-dark)}
header{position:sticky;top:0;background:linear-gradient(135deg,var(--brand-blue),var(--brand-green));color:#fff;display:flex;justify-content:space-between;align-items:center;padding:12px 24px;border-bottom:3px solid var(--brand-green);flex-wrap:wrap;z-index:100}
header h1{margin:0;font-size:clamp(18px,4vw,26px);display:flex;gap:10px;align-items:center}
header img{height:36px;border-radius:6px}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;align-items:center}
.btn{border:none;padding:10px 16px;border-radius:12px;cursor:pointer;background:#f9fafb;color:#111;font-weight:600;transition:transform var(--transition),background var(--transition),box-shadow var(--transition)}
select.lang{appearance:none;border:none;padding:10px 16px;border-radius:12px;font-weight:700;cursor:pointer}
body.dark .btn{background:#374151;color:#fff}
.btn:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,.2);background:#e0f2fe}
body.dark .btn:hover{background:#4b5563}
.btn.primary{background:linear-gradient(135deg,var(--brand-blue),var(--brand-green));color:#fff}
main.wrap{max-width:1000px;margin:20px auto 40px;padding:20px}
#menu{text-align:center;display:flex;flex-direction:column;align-items:center;gap:16px;padding:40px}
#menu ul{text-align:left;max-width:700px;margin:0 auto 20px;line-height:1.6}
#game{display:flex;flex-direction:column;align-items:center;gap:20px}
.card{width:90%;max-width:800px;background:var(--card-light);padding:20px;border-radius:var(--radius);box-shadow:var(--shadow);position:relative;transition:transform var(--transition);display:flex;flex-direction:column;gap:12px}
body.dark .card{background:var(--card-dark);color:var(--ink-dark)}
textarea{width:100%;height:120px;padding:10px;border-radius:12px;border:1px solid #ccc;font-size:1rem;resize:none}
textarea:focus{outline:none;border-color:var(--brand-blue)}
.badge{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:#e8f5e9;color:#064e3b;font-weight:700}
.badge.rec{background:#fff7ed;color:#7c2d12}
#audioPreview{margin-top:10px}
#progressBarContainer{width:100%;background:#ddd;border-radius:10px;overflow:hidden;margin:20px 0}
#progressBar{height:20px;background:linear-gradient(90deg,var(--brand-blue),var(--brand-green));width:0%;transition:width .5s ease}
#phaseInfo{text-align:center;font-weight:700;margin-bottom:10px}
#timer{text-align:center;font-weight:700;margin:10px 0;font-size:1.1rem}
.table{border-collapse:collapse;width:100%;max-width:900px;margin:20px auto;font-size:.95rem;border-radius:12px;overflow:hidden}
.table th,.table td{border:1px solid #ccc;padding:10px;text-align:left}
.table th{background:linear-gradient(135deg,var(--brand-blue),var(--brand-green));color:#fff;font-weight:600}
.correct{background:#d4edda}
.incorrect{background:#f8d7da}
.result-box{max-width:900px;margin:20px auto;padding:20px;background:#fff;border-radius:16px;box-shadow:var(--shadow)}
body.dark .result-box{background:#1f2937;color:var(--ink-dark)}
.result-header{text-align:center;margin-bottom:20px}
.result-header h2{font-size:1.8rem;color:var(--brand-blue)}
.result-summary{display:flex;justify-content:space-around;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:20px}
.result-card{background:linear-gradient(135deg,var(--brand-blue),var(--brand-green));color:#fff;padding:20px;border-radius:16px;flex:1 1 200px;text-align:center;box-shadow:var(--shadow)}
.medal{font-size:2rem;text-align:center;margin-top:20px;animation:jump 1s infinite alternate}
@keyframes jump{0%{transform:translateY(0)}100%{transform:translateY(-10px)}}
.confetti{position:fixed;top:0;left:50%;width:10px;height:10px;background:var(--brand-green);opacity:.7;animation:fall 3s linear forwards;z-index:9999}
@keyframes fall{0%{transform:translateY(-10px) rotate(0)}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
footer{text-align:center;padding:16px 0;color:#555;font-size:.9rem;border-top:1px solid #ccc;display:flex;flex-direction:column;align-items:center;gap:8px}
footer img{height:25px}
body.dark footer{color:#aaa;border-color:#444}
@media(max-width:600px){header{flex-direction:column;align-items:flex-start}.controls{margin-top:10px;justify-content:flex-start}}
</style>
</head>
<body>
<header>
  <h1><img src="https://opiniaobrasilia.com.br/wp-content/uploads/2020/12/RenovaDF.jpeg" alt="Logo Renova DF"> <span id="appTitle">Simulador de Entrevista</span></h1>
  <div class="controls">
    <select class="lang" id="lang">
      <option value="pt" selected>ğŸ‡§ğŸ‡· PortuguÃªs</option>
      <option value="en">ğŸ‡ºğŸ‡¸ English</option>
      <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
    </select>
    <button class="btn" id="toggleDark">ğŸŒ™</button>
    <button class="btn" id="backBtn">ğŸ  InÃ­cio</button>
  </div>
</header>

<main class="wrap">
  <div id="menu">
    <h2 id="welcome">ğŸ¯ Bem-vindo ao Simulador de Entrevista â€“ TechNova Solutions</h2>
    <p id="intro">VocÃª participarÃ¡ de uma entrevista para a vaga de <strong>Analista de Projetos</strong> com salÃ¡rio de <strong>R$4.500,00</strong>.</p>
    <p id="howtoTitle">ğŸ’¡ Como usar:</p>
    <ul id="howtoList">
      <li>Clique em <strong>Ouvir Pergunta ğŸ”Š</strong> para escutar a questÃ£o.</li>
      <li>Responda <em>por texto</em> ou use <strong>ğŸ¤ Falar</strong> para transcrever sua resposta (sem Ã¡udio).</li>
      <li>Clique em <strong>âœ… Enviar Resposta</strong> para avanÃ§ar.</li>
      <li>Respostas anteriores desaparecem quando novas perguntas aparecem.</li>
      <li>Ao final, vocÃª verÃ¡ resumo, pontuaÃ§Ã£o e medalha.</li>
    </ul>
    <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
      <button class="btn primary" id="btnReadInstr">ğŸ”Š Ouvir InstruÃ§Ãµes</button>
      <button class="btn primary" id="btnStart">â–¶ï¸ Iniciar SimulaÃ§Ã£o</button>
    </div>
  </div>

  <div id="phaseInfo" style="display:none"></div>
  <div id="timer" style="display:none">â±ï¸ 00:00</div>
  <div id="progressBarContainer" style="display:none"><div id="progressBar"></div></div>

  <div id="game"></div>
</main>

<footer>
  <img src="https://opiniaobrasilia.com.br/wp-content/uploads/2020/12/RenovaDF.jpeg" alt="Logo Renova DF">
  <span id="signature">Criado por Marcelo Emanoel</span>
</footer>

<script>
// ===== I18N =====
const I18N = {
  pt: {
    htmlLang: 'pt-BR',
    title: 'Simulador de Entrevista',
    welcome: 'ğŸ¯ Bem-vindo ao Simulador de Entrevista â€“ TechNova Solutions',
    intro: 'VocÃª participarÃ¡ de uma entrevista para a vaga de <strong>Analista de Projetos</strong> com salÃ¡rio de <strong>R$4.500,00</strong>.',
    howtoTitle: 'ğŸ’¡ Como usar:',
    howto: [
      'Clique em <strong>Ouvir Pergunta ğŸ”Š</strong> para escutar a questÃ£o.',
      'Responda <em>por texto</em> ou use <strong>ğŸ¤ Falar</strong> para transcrever sua resposta (sem Ã¡udio).',
      'Clique em <strong>âœ… Enviar Resposta</strong> para avanÃ§ar.',
      'Respostas anteriores desaparecem quando novas perguntas aparecem.',
      'Ao final, vocÃª verÃ¡ resumo, pontuaÃ§Ã£o e medalha.'
    ],
    btnReadInstr: 'ğŸ”Š Ouvir InstruÃ§Ãµes',
    btnStart: 'â–¶ï¸ Iniciar SimulaÃ§Ã£o',
    back: 'ğŸ  InÃ­cio',
    speakQ: 'ğŸ”Š Ouvir Pergunta',
    speak: 'ğŸ¤ Falar',
    stop: 'â¹ï¸ Parar',
    send: 'âœ… Enviar Resposta',
    placeholder: 'Digite sua resposta aqui...',
    phase: (i, n) => `ğŸ“ Pergunta ${i} de ${n}`,
    timerPrefix: 'â±ï¸ ',
    summaryTitle: 'ğŸ† Resumo da Entrevista',
    answered: 'Perguntas Respondidas',
    totalKw: 'Total de Palavras-chave',
    hits: 'Acertos',
    chance: 'Chance da Vaga',
    congrats: 'ğŸ–ï¸ ParabÃ©ns! SimulaÃ§Ã£o concluÃ­da.',
    backMenu: 'ğŸ  Voltar ao Menu',
    createdBy: 'Criado por Marcelo Emanoel',
    voice: 'pt-BR',
    questions: [
      {q:'Como vocÃª lida com conflitos no trabalho?', keywords:['conflito','negociaÃ§Ã£o','resoluÃ§Ã£o']},
      {q:'Como prioriza tarefas?', keywords:['priorizaÃ§Ã£o','organizaÃ§Ã£o','foco']},
      {q:'Como se comunica com colegas?', keywords:['comunicaÃ§Ã£o','clareza','respeito']},
      {q:'Como demonstra proatividade?', keywords:['proatividade','iniciativa','responsabilidade']},
      {q:'Como lida com pressÃ£o?', keywords:['pressÃ£o','controle','resiliÃªncia']},
      {q:'Como aprende coisas novas rapidamente?', keywords:['aprendizado','curiosidade','eficiÃªncia']},
      {q:'Como trabalha em equipe?', keywords:['colaboraÃ§Ã£o','cooperaÃ§Ã£o','respeito']},
      {q:'Como organiza seu tempo?', keywords:['organizaÃ§Ã£o','tempo','planejamento']},
      {q:'Como resolve problemas?', keywords:['resoluÃ§Ã£o','anÃ¡lise','criatividade']},
      {q:'Como recebe feedback?', keywords:['feedback','melhoria','aberto']},
      {q:'Como busca resultados?', keywords:['resultado','eficiÃªncia','meta']},
      {q:'Como lida com erros?', keywords:['erro','aprendizado','resiliÃªncia']},
      {q:'Como lidera projetos?', keywords:['lideranÃ§a','coordenaÃ§Ã£o','gestÃ£o']},
      {q:'Como se adapta a mudanÃ§as?', keywords:['adaptaÃ§Ã£o','flexibilidade','resiliÃªncia']},
      {q:'Como comunica ideias complexas?', keywords:['comunicaÃ§Ã£o','clareza','impacto']}
    ]
  },
  en: {
    htmlLang: 'en',
    title: 'Interview Simulator',
    welcome: 'ğŸ¯ Welcome to the Interview Simulator â€“ TechNova Solutions',
    intro: 'You will take part in an interview for the <strong>Project Analyst</strong> role with a salary of <strong>$4,500</strong>.',
    howtoTitle: 'ğŸ’¡ How to use:',
    howto: [
      'Click <strong>Hear Question ğŸ”Š</strong> to listen to the prompt.',
      'Answer by <em>typing</em> or use <strong>ğŸ¤ Speak</strong> to transcribe your answer (no audio).',
      'Click <strong>âœ… Submit Answer</strong> to proceed.',
      'Previous answers disappear when new questions appear.',
      'At the end you will see a summary, score, and medal.'
    ],
    btnReadInstr: 'ğŸ”Š Hear Instructions',
    btnStart: 'â–¶ï¸ Start Simulation',
    back: 'ğŸ  Home',
    speakQ: 'ğŸ”Š Hear Question',
    speak: 'ğŸ¤ Speak',
    stop: 'â¹ï¸ Stop',
    send: 'âœ… Submit Answer',
    placeholder: 'Type your answer here...',
    phase: (i, n) => `ğŸ“ Question ${i} of ${n}`,
    timerPrefix: 'â±ï¸ ',
    summaryTitle: 'ğŸ† Interview Summary',
    answered: 'Questions Answered',
    totalKw: 'Total Keywords',
    hits: 'Matches',
    chance: 'Hiring Chance',
    congrats: 'ğŸ–ï¸ Congratulations! Simulation completed.',
    backMenu: 'ğŸ  Back to Menu',
    createdBy: 'Created by Marcelo Emanoel',
    voice: 'en-US',
    questions: [
      {q:'How do you handle conflicts at work?', keywords:['conflict','negotiation','resolution']},
      {q:'How do you prioritize tasks?', keywords:['prioritization','organization','focus']},
      {q:'How do you communicate with coworkers?', keywords:['communication','clarity','respect']},
      {q:'How do you demonstrate proactiveness?', keywords:['proactivity','initiative','responsibility']},
      {q:'How do you handle pressure?', keywords:['pressure','control','resilience']},
      {q:'How do you learn new things quickly?', keywords:['learning','curiosity','efficiency']},
      {q:'How do you work in a team?', keywords:['collaboration','cooperation','respect']},
      {q:'How do you organize your time?', keywords:['organization','time','planning']},
      {q:'How do you solve problems?', keywords:['resolution','analysis','creativity']},
      {q:'How do you receive feedback?', keywords:['feedback','improvement','open']},
      {q:'How do you pursue results?', keywords:['results','efficiency','goal']},
      {q:'How do you deal with mistakes?', keywords:['mistake','learning','resilience']},
      {q:'How do you lead projects?', keywords:['leadership','coordination','management']},
      {q:'How do you adapt to change?', keywords:['adaptation','flexibility','resilience']},
      {q:'How do you communicate complex ideas?', keywords:['communication','clarity','impact']}
    ]
  },
  es: {
    htmlLang: 'es',
    title: 'Simulador de Entrevista',
    welcome: 'ğŸ¯ Bienvenido al Simulador de Entrevista â€“ TechNova Solutions',
    intro: 'ParticiparÃ¡s en una entrevista para el puesto de <strong>Analista de Proyectos</strong> con salario de <strong>$4.500</strong>.',
    howtoTitle: 'ğŸ’¡ CÃ³mo usar:',
    howto: [
      'Haz clic en <strong>Escuchar Pregunta ğŸ”Š</strong> para oÃ­r el enunciado.',
      'Responde <em>por texto</em> o usa <strong>ğŸ¤ Hablar</strong> para transcribir tu respuesta (sin audio).',
      'Haz clic en <strong>âœ… Enviar Respuesta</strong> para avanzar.',
      'Las respuestas anteriores desaparecen cuando aparecen nuevas preguntas.',
      'Al final verÃ¡s un resumen, puntaje y medalla.'
    ],
    btnReadInstr: 'ğŸ”Š Escuchar Instrucciones',
    btnStart: 'â–¶ï¸ Iniciar SimulaciÃ³n',
    back: 'ğŸ  Inicio',
    speakQ: 'ğŸ”Š Escuchar Pregunta',
    speak: 'ğŸ¤ Hablar',
    stop: 'â¹ï¸ Detener',
    send: 'âœ… Enviar Respuesta',
    placeholder: 'Escribe tu respuesta aquÃ­...',
    phase: (i, n) => `ğŸ“ Pregunta ${i} de ${n}`,
    timerPrefix: 'â±ï¸ ',
    summaryTitle: 'ğŸ† Resumen de la Entrevista',
    answered: 'Preguntas Respondidas',
    totalKw: 'Palabras clave totales',
    hits: 'Aciertos',
    chance: 'Probabilidad de ContrataciÃ³n',
    congrats: 'ğŸ–ï¸ Â¡Felicidades! SimulaciÃ³n completada.',
    backMenu: 'ğŸ  Volver al MenÃº',
    createdBy: 'Creado por Marcelo Emanoel',
    voice: 'es-ES',
    questions: [
      {q:'Â¿CÃ³mo manejas los conflictos en el trabajo?', keywords:['conflicto','negociaciÃ³n','resoluciÃ³n']},
      {q:'Â¿CÃ³mo priorizas las tareas?', keywords:['priorizaciÃ³n','organizaciÃ³n','enfoque']},
      {q:'Â¿CÃ³mo te comunicas con tus compaÃ±eros?', keywords:['comunicaciÃ³n','claridad','respeto']},
      {q:'Â¿CÃ³mo demuestras proactividad?', keywords:['proactividad','iniciativa','responsabilidad']},
      {q:'Â¿CÃ³mo manejas la presiÃ³n?', keywords:['presiÃ³n','control','resiliencia']},
      {q:'Â¿CÃ³mo aprendes cosas nuevas rÃ¡pidamente?', keywords:['aprendizaje','curiosidad','eficiencia']},
      {q:'Â¿CÃ³mo trabajas en equipo?', keywords:['colaboraciÃ³n','cooperaciÃ³n','respeto']},
      {q:'Â¿CÃ³mo organizas tu tiempo?', keywords:['organizaciÃ³n','tiempo','planificaciÃ³n']},
      {q:'Â¿CÃ³mo resuelves problemas?', keywords:['resoluciÃ³n','anÃ¡lisis','creatividad']},
      {q:'Â¿CÃ³mo recibes retroalimentaciÃ³n?', keywords:['feedback','mejora','abierto']},
      {q:'Â¿CÃ³mo buscas resultados?', keywords:['resultado','eficiencia','meta']},
      {q:'Â¿CÃ³mo manejas los errores?', keywords:['error','aprendizaje','resiliencia']},
      {q:'Â¿CÃ³mo lideras proyectos?', keywords:['liderazgo','coordinaciÃ³n','gestiÃ³n']},
      {q:'Â¿CÃ³mo te adaptas a los cambios?', keywords:['adaptaciÃ³n','flexibilidad','resiliencia']},
      {q:'Â¿CÃ³mo comunicas ideas complejas?', keywords:['comunicaciÃ³n','claridad','impacto']}
    ]
  }
};

let currentLang = 'pt';
let currentQuestion = 0, seconds = 0, timerInterval;
let answers = [];
let recognizer = null; // SpeechRecognition instance
let recognising = false;

// ===== Helpers =====
function setLang(lang){
  currentLang = lang;
  const L = I18N[lang];
  document.documentElement.lang = L.htmlLang;
  document.getElementById('appTitle').textContent = L.title;
  document.getElementById('welcome').textContent = L.welcome;
  document.getElementById('intro').innerHTML = L.intro;
  document.getElementById('howtoTitle').textContent = L.howtoTitle;
  document.getElementById('howtoList').innerHTML = L.howto.map(li=>`<li>${li}</li>`).join('');
  document.getElementById('btnReadInstr').textContent = L.btnReadInstr;
  document.getElementById('btnStart').textContent = L.btnStart;
  document.getElementById('backBtn').textContent = L.back;
  document.getElementById('signature').textContent = L.createdBy;
}

function speakText(text){
  if(window.speechSynthesis.speaking) window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = I18N[currentLang].voice;
  const voices = speechSynthesis.getVoices();
  const pref = voices.find(v=>v.lang && v.lang.startsWith(I18N[currentLang].voice.split('-')[0]));
  if(pref) u.voice = pref;
  window.speechSynthesis.speak(u);
}

function startSimulation(){
  currentQuestion = 0; seconds = 0; answers = [];
  document.getElementById('menu').style.display = 'none';
  showQuestion(currentQuestion);
  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{ seconds++; updateTimer(); }, 1000);
  updateTimer();
}

function updateTimer(){
  const L = I18N[currentLang];
  const n = I18N[currentLang].questions.length;
  document.getElementById('timer').style.display = 'block';
  document.getElementById('phaseInfo').style.display = 'block';
  document.getElementById('phaseInfo').textContent = L.phase(currentQuestion+1, n);
  document.getElementById('timer').textContent = L.timerPrefix + formatTime(seconds);
  document.getElementById('progressBarContainer').style.display = 'block';
}

function formatTime(sec){
  const m = Math.floor(sec/60).toString().padStart(2,'0');
  const s = (sec%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

function normalize(str){
  return (str||'').toString().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'');
}

// ===== Voice Recognition (no audio elements) =====
function createRecognizer(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR) return null;
  const rec = new SR();
  rec.lang = I18N[currentLang].voice;
  rec.interimResults = true;
  rec.maxAlternatives = 1;
  return rec;
}

function toggleDictation(btn, textarea){
  if(!recognizer){ recognizer = createRecognizer(); }
  if(!recognizer){ alert(currentLang==='en' ? 'Your browser does not support speech recognition.' : currentLang==='es' ? 'Tu navegador no admite reconocimiento de voz.' : 'Seu navegador nÃ£o suporta reconhecimento de voz.'); return; }

  if(!recognising){
    recognizer.lang = I18N[currentLang].voice;
    textarea.dataset.prev = textarea.value;
    textarea.value = '';
    btn.textContent = I18N[currentLang].stop + ' ğŸ¤';
    btn.classList.add('primary');
    recognising = true;
    recognizer.onresult = (e)=>{
      let text = '';
      for(let i=e.resultIndex;i<e.results.length;i++){
        text += e.results[i][0].transcript + (e.results[i].isFinal ? ' ' : '');
      }
      textarea.value = text.trim();
    };
    recognizer.onend = ()=>{ recogniserStopped(btn); };
    recognizer.onerror = ()=>{ recogniserStopped(btn); };
    recognizer.start();
  } else {
    recognizer.stop();
  }
}

function recogniserStopped(btn){
  recognising = false;
  btn.textContent = I18N[currentLang].speak;
  btn.classList.remove('primary');
}

// ===== Flow =====
function showQuestion(idx){
  const L = I18N[currentLang];
  const Q = L.questions;
  if(idx >= Q.length){ finishInterview(); return; }
  if(window.speechSynthesis.speaking) window.speechSynthesis.cancel();
  const q = Q[idx];
  const game = document.getElementById('game');
  game.innerHTML = `
    <div class="card">
      <p><strong>${L.phase(idx+1, Q.length)}</strong></p>
      <p style="font-size:1.05rem">${q.q}</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn primary" id="btnHear">${L.speakQ}</button>
        <span class="badge" id="kwBadge">${L.totalKw}: <span id="kwCount">${q.keywords.length}</span></span>
        <span class="badge rec" id="recBadge" style="display:none">ğŸ™ï¸ REC</span>
      </div>
      <textarea id="answerBox" placeholder="${L.placeholder}"></textarea>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn" id="dictBtn">${L.speak}</button>
        <button class="btn primary" id="sendBtn">${L.send}</button>
      </div>
      <small style="opacity:.7">${currentLang==='en'?'Voice answers are transcribed only (no audio saved or played).':currentLang==='es'?'Las respuestas por voz se transcriben Ãºnicamente (no se guarda ni reproduce audio).':'Respostas por voz sÃ£o apenas transcritas (sem salvar ou reproduzir Ã¡udio).'}</small>
    </div>
  `;

  // handlers
  document.getElementById('btnHear').onclick = ()=> speakText(q.q);
  const textarea = document.getElementById('answerBox');
  const dictBtn = document.getElementById('dictBtn');
  dictBtn.onclick = ()=>{ document.getElementById('recBadge').style.display='inline-flex'; toggleDictation(dictBtn, textarea); };

  document.getElementById('sendBtn').onclick = ()=>{
    answers.push({ question:q.q, answer:textarea.value||'', keywords:q.keywords.slice() });
    const percent=((idx+1)/Q.length)*100; document.getElementById('progressBar').style.width=percent+'%';
    currentQuestion++; showQuestion(currentQuestion);
  };
}

function finishInterview(){
  clearInterval(timerInterval);
  const L = I18N[currentLang];
  document.getElementById('game').innerHTML = '';
  document.getElementById('phaseInfo').style.display = 'none';
  document.getElementById('timer').style.display = 'none';
  document.getElementById('progressBarContainer').style.display = 'none';

  let hits=0,total=0;
  answers.forEach(a=>{ total += a.keywords.length; const ansN = normalize(a.answer); a.keywords.forEach(k=>{ if(ansN.includes(normalize(k))) hits++; }); });
  const chance = total? Math.round((hits/total)*100) : 0;

  for(let i=0;i<50;i++){
    const confetti=document.createElement('div'); confetti.className='confetti'; confetti.style.left=Math.random()*100+'%'; confetti.style.background=Math.random()>0.5?'var(--brand-blue)':'var(--brand-green)'; confetti.style.animationDuration=(2+Math.random()*2)+'s'; document.body.appendChild(confetti); setTimeout(()=>confetti.remove(),4000);
  }

  const tableRows = answers.map(a=>{
    let matchCount=0; const ansN = normalize(a.answer); a.keywords.forEach(k=>{ if(ansN.includes(normalize(k))) matchCount++; });
    return `<tr class="${matchCount>0?'correct':'incorrect'}"><td>${a.question}</td><td>${a.answer||'â€”'}</td><td>${a.keywords.join(', ')}</td></tr>`;
  }).join('');

  const html = `
    <div class="result-box">
      <div class="result-header"><h2>${L.summaryTitle}</h2></div>
      <div class="result-summary">
        <div class="result-card">${L.answered}<br><strong>${I18N[currentLang].questions.length}</strong></div>
        <div class="result-card">${L.totalKw}<br><strong>${total}</strong></div>
        <div class="result-card">${L.hits}<br><strong>${hits}</strong></div>
        <div class="result-card">${L.chance}<br><strong>${chance}%</strong></div>
      </div>
      <table class="table"><tr><th>${currentLang==='en'?'Question':currentLang==='es'?'Pregunta':'Pergunta'}</th><th>${currentLang==='en'?'Answer':currentLang==='es'?'Respuesta':'Resposta'}</th><th>${L.totalKw}</th></tr>${tableRows}</table>
      <p class="medal">${L.congrats}</p>
      <div style="text-align:center"><button class="btn primary" id="backMenuBtn">${L.backMenu}</button></div>
    </div>`;
  document.getElementById('game').innerHTML = html;
  speakText((currentLang==='en'?'Simulation finished. Your hiring chance is ':'SimulaÃ§Ã£o concluÃ­da. Sua chance da vaga Ã© de ')+(chance)+(currentLang==='es'?' por ciento.': currentLang==='en'?' percent.':' por cento.'));
  document.getElementById('backMenuBtn').onclick = backToMenu;
}

function backToMenu(){
  if(window.speechSynthesis.speaking) window.speechSynthesis.cancel();
  clearInterval(timerInterval);
  document.getElementById('game').innerHTML='';
  document.getElementById('menu').style.display='flex';
  document.getElementById('progressBar').style.width='0%';
  answers=[]; seconds=0; currentQuestion=0;
}

// ===== Wire up header + menu =====
document.getElementById('toggleDark').onclick = ()=> document.body.classList.toggle('dark');
document.getElementById('backBtn').onclick = backToMenu;

// language
setLang('pt');
document.getElementById('lang').addEventListener('change', (e)=>{ setLang(e.target.value); });

// menu buttons
const readInstr = ()=>{
  const L = I18N[currentLang];
  const text = [L.welcome, L.intro.replace(/<[^>]+>/g,''), L.howtoTitle, ...L.howto.map(x=>x.replace(/<[^>]+>/g,''))].join('. ');
  speakText(text);
};
document.getElementById('btnReadInstr').onclick = readInstr;
document.getElementById('btnStart').onclick = startSimulation;
</script>
</body>
</html>

